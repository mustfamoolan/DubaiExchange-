import{r as c,j as e,d as oe}from"./app-Dj9b6vpa.js";import{E as re}from"./EmployeeLayout-BE5LYx1E.js";import{u as se,T as ne}from"./ThermalReceipt-3WR97ffO.js";import{u as le}from"./useCentralCashBalance-Dhe9mmJI.js";import{u as ce}from"./useCentralDollarBalance-DO3vyDkh.js";import{u as ie,N as de}from"./useNotification-C6JUMQqk.js";/* empty css            */function Ne({user:_,currentDollarBalance:O=0,currentBalance:P=0,currentCashBalance:I=0,currentCentralDollarBalance:f=0,openingDollarBalance:A=0,openingBalance:me=0,openingCashBalance:D=0,exchangeRate:C=1500,transactions:ue=[],quickReport:x={charges:0,payments:0,operations:0,dollars_sold:0}}){const[ge,L]=c.useState(O),[xe,k]=c.useState(P),[u,R]=c.useState({charges:x.charges,payments:x.payments,operations:x.operations,dollars_sold:x.dollars_sold}),{centralCashBalance:V,updateBalanceAfterTransaction:B}=le(I),{centralDollarBalance:l,updateBalanceAfterTransaction:$}=ce(f);console.log("Initial Values:"),console.log("currentCentralDollarBalance prop:",f),console.log("centralDollarBalance from hook:",l),console.log("Type of centralDollarBalance:",typeof l);const[a,g]=c.useState({documentNumber:"",currentTime:new Date().toLocaleString("ar-EG"),dollarAmount:"",exchangeRate:C,notes:"",employeeName:_?.name||"الموظف الحالي"}),[p,h]=c.useState(!1),[y,j]=c.useState(""),[G,S]=c.useState(""),{showReceipt:U,receiptData:T,createSellReceipt:Y,printReceipt:q,closeReceipt:J}=se(),{notification:m,showSuccess:M,showError:i,showWarning:K,closeNotification:Q}=ie();c.useEffect(()=>{const o=()=>{const n=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});S(n)};o();const r=setInterval(o,1e3);return()=>clearInterval(r)},[]),c.useEffect(()=>{(()=>{const r=new Date,t=r.getFullYear().toString()+(r.getMonth()+1).toString().padStart(2,"0")+r.getDate().toString().padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");j(`SELL${t}${n}`)})()},[]),c.useEffect(()=>{g(o=>({...o,documentNumber:y}))},[y]);const E=o=>{const t=o.toString().replace(/[^0-9.]/g,"").split(".");return t.length>2?t[0]+"."+t.slice(1).join(""):(t[1]&&(t[1]=t[1].replace(/0+$/,""),t[1]===""&&t.pop()),t[0]&&(t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")),t.join("."))},s=o=>o.toString().replace(/,/g,""),W=(o,r)=>{const t=s(r);g(n=>({...n,[o]:t}))},F=(o,r)=>{const t=s(r);g(n=>({...n,[o]:t}))},N=()=>{const o=parseFloat(s(a.dollarAmount))||0,r=parseFloat(s(a.exchangeRate))||0;return o*r},X=()=>N(),b=()=>{const o=parseFloat(s(a.dollarAmount))||0;return console.log("checkSufficientDollarBalance - Dollar Amount:",o),console.log("checkSufficientDollarBalance - Central Dollar Balance:",l),console.log("checkSufficientDollarBalance - Type of centralDollarBalance:",typeof l),console.log("checkSufficientDollarBalance - Comparison result:",o<=l),console.log("checkSufficientDollarBalance - currentCentralDollarBalance prop:",f),o<=l},z=()=>{const o=parseFloat(s(a.dollarAmount))||0;return o>l?`الرصيد غير كافي. المطلوب: $${o.toLocaleString()}، المتاح: $${Math.floor(l).toLocaleString()}`:null},H=async()=>{if(!a.dollarAmount||parseFloat(s(a.dollarAmount))<=0){i("خطأ في المدخلات","يرجى إدخال مبلغ صحيح بالدولار");return}const o=parseFloat(s(a.dollarAmount));if(console.log("Dollar Amount:",o),console.log("Central Dollar Balance:",l),o>l){i("رصيد غير كافي",`الرصيد المركزي للدولار غير كافي. المطلوب: $${o.toLocaleString()}، المتاح: $${Math.floor(l).toLocaleString()}`);return}h(!0);try{console.log("Sending request to server with data:",{dollarAmount:s(a.dollarAmount),exchangeRate:s(a.exchangeRate),documentNumber:a.documentNumber,notes:a.notes});const r=await fetch("/employee/sell",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:s(a.dollarAmount),exchangeRate:s(a.exchangeRate),documentNumber:a.documentNumber,notes:a.notes})});if(console.log("Server response status:",r.status),console.log("Server response ok:",r.ok),r.ok){const t=await r.json();L(t.new_dollar_balance),k(t.new_cash_balance),t.new_cash_balance!==void 0&&B(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&$(t.new_central_dollar_balance),t.updated_report&&R({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_sold:t.updated_report.dollars_sold}),g(w=>({...w,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const n=new Date,d=n.getFullYear().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0"),v=Math.floor(Math.random()*1e3).toString().padStart(3,"0");j(`SELL${d}${v}`),S(n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),M("تم إنجاز العملية بنجاح!","تم إجراء عملية البيع وتحديث الأرصدة بنجاح")}else{console.log("Server response not ok, status:",r.status);let t="حدث خطأ غير متوقع";try{const n=await r.json();console.log("Server error response:",n),t=n.message||"حدث خطأ غير متوقع"}catch{const d=await r.text();console.error("خطأ في الاستجابة:",d),t="خطأ في الخادم"}i("فشل في العملية",t)}}catch(r){console.error("Error:",r),i("خطأ في الشبكة","تعذر الاتصال بالخادم، يرجى المحاولة مرة أخرى")}finally{h(!1)}},Z=()=>{H()},ee=async()=>{if(!a.dollarAmount||parseFloat(s(a.dollarAmount))<=0){i("خطأ في المدخلات","يرجى إدخال مبلغ صحيح بالدولار قبل المتابعة");return}const o=parseFloat(s(a.dollarAmount));if(console.log("SaveAndPrint - Dollar Amount:",o),console.log("SaveAndPrint - Central Dollar Balance:",l),o>l){i("رصيد غير كافي",`الرصيد المركزي للدولار غير كافي. المطلوب: $${o.toLocaleString()}، المتاح: $${Math.floor(l).toLocaleString()}`);return}h(!0);try{console.log("SaveAndPrint - Sending request to /employee/sell with data:",{dollarAmount:s(a.dollarAmount),exchangeRate:s(a.exchangeRate),documentNumber:a.documentNumber,notes:a.notes});const r=await fetch("/employee/sell",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:s(a.dollarAmount),exchangeRate:s(a.exchangeRate),documentNumber:a.documentNumber,notes:a.notes})});if(console.log("SaveAndPrint - Server response status:",r.status),console.log("SaveAndPrint - Server response ok:",r.ok),r.ok){const t=await r.json();if(console.log("SaveAndPrint - Server response data:",t),L(t.new_dollar_balance),k(t.new_cash_balance),t.new_cash_balance!==void 0&&B(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&$(t.new_central_dollar_balance),t.updated_report&&R({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_sold:t.updated_report.dollars_sold}),(await Y({reference_number:a.documentNumber,dollar_amount:parseFloat(a.dollarAmount),exchange_rate:parseFloat(a.exchangeRate),iqd_amount:N(),total_amount:X(),notes:a.notes,customer_phone:null})).success){g(ae=>({...ae,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const d=new Date,v=d.getFullYear().toString()+(d.getMonth()+1).toString().padStart(2,"0")+d.getDate().toString().padStart(2,"0"),w=Math.floor(Math.random()*1e3).toString().padStart(3,"0");j(`SELL${v}${w}`),S(d.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),M("تم إنجاز العملية بنجاح!","تم إجراء عملية البيع وإعداد الفاتورة للطباعة")}else K("تحذير","تم حفظ العملية لكن فشل في إنشاء الفاتورة")}else{console.log("SaveAndPrint - Server response not ok, status:",r.status);const t=await r.json();console.log("SaveAndPrint - Server error response:",t),i("فشل في العملية",t.message||"حدث خطأ غير متوقع")}}catch(r){console.error("Error:",r),i("خطأ في الشبكة","تعذر الاتصال بالخادم، يرجى المحاولة مرة أخرى")}finally{h(!1)}},te=()=>{oe.visit("/employee/dashboard")};return e.jsxs(re,{title:"بيع الدولار",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:te,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/sell.png",alt:"بيع الدولار",className:"w-12 h-12 object-contain",onError:o=>{o.target.style.display="none",o.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-orange-600 hidden",children:"🏪"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"بيع الدولار"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"الرصيد المركزي للدولار"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-700",children:["$",Math.floor(l).toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(V).toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدولار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:["$",A>0?Math.floor(A).toLocaleString():"0"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدينار النقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[D>0?Math.floor(D).toLocaleString():"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-700",children:"مبيعات:"}),e.jsxs("span",{className:"font-bold text-green-800",children:[u.payments>0?Math.floor(u.payments).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"دولار مباع:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[u.dollars_sold>0?Math.floor(u.dollars_sold).toLocaleString():"0"," $"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:u.operations})]})})]}),e.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:a.documentNumber,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:y,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:G,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right bg-gray-50",value:_?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار:"}),e.jsx("input",{type:"text",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right ${a.dollarAmount&&!b()?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"المبلغ بالدولار",value:a.dollarAmount?E(a.dollarAmount):"",onChange:o=>F("dollarAmount",o.target.value)}),a.dollarAmount&&!b()&&e.jsx("p",{className:"text-xs text-red-600 mt-1 text-right",children:z()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"سعر الصرف:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:a.exchangeRate?E(a.exchangeRate):"",onChange:o=>F("exchangeRate",o.target.value),placeholder:"سعر الصرف"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 text-right",children:["السعر الافتراضي: ",C.toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700",children:"المبلغ بالدولار"}),e.jsxs("p",{className:"text-xl font-bold text-blue-800",children:["$",parseFloat(a.dollarAmount||0).toLocaleString()]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"المبلغ بالدينار"}),e.jsxs("p",{className:"text-xl font-bold text-orange-800",children:[N().toLocaleString()," د.ع"]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:a.notes,onChange:o=>W("notes",o.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:ee,disabled:p||!a.dollarAmount||!b(),className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),p?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:Z,disabled:p||!a.dollarAmount||!b(),className:"bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),p?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),U&&T&&e.jsx(ne,{receiptData:T,onClose:J,onPrint:q}),e.jsx(de,{isOpen:m.isOpen,type:m.type,title:m.title,message:m.message,autoClose:m.autoClose,autoCloseDelay:m.autoCloseDelay,onClose:Q})]})}export{Ne as default};
