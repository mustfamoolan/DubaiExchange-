import{r as o,j as e,b as K}from"./app-CKwdU0BM.js";import{E as X}from"./EmployeeLayout-FjOdUBLp.js";import{u as Q,T as z}from"./ThermalReceipt-DQsAEC3E.js";/* empty css            */function ae({user:v,currentDollarBalance:C=0,currentIQDBalance:E=0,currentCashBalance:$=0,openingDollarBalance:w=0,openingIQDBalance:_=0,openingCashBalance:M=0,exchangeRate:p=1500,transactions:H=[],quickReport:g={charges:0,payments:0,operations:0,dollars_bought:0}}){const[b,A]=o.useState(C),[V,L]=o.useState(E),[l,R]=o.useState($),[d,D]=o.useState({charges:g.charges,payments:g.payments,operations:g.operations,dollars_bought:g.dollars_bought}),[t,m]=o.useState({documentNumber:"",currentTime:new Date().toLocaleString("ar-EG"),dollarAmount:"",exchangeRate:p,commission:"",notes:"",employeeName:v?.name||"الموظف الحالي"}),[x,u]=o.useState(!1),[F,f]=o.useState(""),[k,y]=o.useState(""),{showReceipt:O,receiptData:T,createBuyReceipt:B,printReceipt:q,closeReceipt:I}=Q();o.useEffect(()=>{const a=()=>{const n=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});y(n)};a();const r=setInterval(a,1e3);return()=>clearInterval(r)},[]),o.useEffect(()=>{(()=>{const r=new Date,s=r.getFullYear().toString()+(r.getMonth()+1).toString().padStart(2,"0")+r.getDate().toString().padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${s}${n}`)})()},[]),o.useEffect(()=>{m(a=>({...a,documentNumber:F}))},[F]),o.useEffect(()=>{if(t.dollarAmount&&t.exchangeRate){const a=parseFloat(t.dollarAmount),r=parseFloat(t.exchangeRate);if(!isNaN(a)&&!isNaN(r)){const s=a*r,n=Math.round(s*.01);m(i=>({...i,commission:n.toString()}))}}},[t.dollarAmount,t.exchangeRate]);const h=(a,r)=>{m(s=>({...s,[a]:r}))},j=()=>{const a=parseFloat(t.dollarAmount)||0,r=parseFloat(t.exchangeRate)||0;return r>0?a*r:0},c=()=>{const a=j(),r=parseFloat(t.commission)||0;return a+r},U=async()=>{if(!t.dollarAmount||parseFloat(t.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}const a=c();if(a>l){alert(`الرصيد النقدي غير كافي. المطلوب: ${Math.floor(a).toLocaleString()} د.ع، المتاح: ${Math.floor(l).toLocaleString()} د.ع`);return}u(!0);try{const r=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:t.dollarAmount,exchangeRate:t.exchangeRate,commission:t.commission,documentNumber:t.documentNumber,notes:t.notes})});if(r.ok){const s=await r.json();A(s.new_dollar_balance),L(s.new_iqd_balance),R(s.new_cash_balance),s.updated_report&&D({charges:s.updated_report.charges,payments:s.updated_report.payments,operations:s.updated_report.operations,dollars_bought:s.updated_report.dollars_bought}),m(S=>({...S,dollarAmount:"",commission:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const n=new Date,i=n.getFullYear().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0"),N=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${i}${N}`),y(n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية الشراء بنجاح!")}else{const s=await r.json();alert(s.message||"حدث خطأ")}}catch(r){console.error("Error:",r),alert("حدث خطأ في الشبكة")}finally{u(!1)}},Y=()=>{U()},P=async()=>{if(!t.dollarAmount||parseFloat(t.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}const a=c();if(a>l){alert(`الرصيد النقدي غير كافي. المطلوب: ${Math.floor(a).toLocaleString()} د.ع، المتاح: ${Math.floor(l).toLocaleString()} د.ع`);return}u(!0);try{const r=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:t.dollarAmount,exchangeRate:t.exchangeRate,commission:t.commission,documentNumber:t.documentNumber,notes:t.notes})});if(r.ok){const s=await r.json();if(A(s.new_dollar_balance),L(s.new_iqd_balance),R(s.new_cash_balance),s.updated_report&&D({charges:s.updated_report.charges,payments:s.updated_report.payments,operations:s.updated_report.operations,dollars_bought:s.updated_report.dollars_bought}),(await B({reference_number:t.documentNumber,dollar_amount:parseFloat(t.dollarAmount),exchange_rate:parseFloat(t.exchangeRate),iqd_amount:j(),commission:parseFloat(t.commission||0),total_amount:c(),notes:t.notes,customer_phone:null})).success){m(J=>({...J,dollarAmount:"",commission:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const i=new Date,N=i.getFullYear().toString()+(i.getMonth()+1).toString().padStart(2,"0")+i.getDate().toString().padStart(2,"0"),S=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${N}${S}`),y(i.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية الشراء وإنشاء الفاتورة بنجاح!")}else alert("تم حفظ العملية لكن فشل في إنشاء الفاتورة")}else{const s=await r.json();alert(s.message||"حدث خطأ")}}catch(r){console.error("Error:",r),alert("حدث خطأ في الشبكة")}finally{u(!1)}},G=()=>{K.visit("/employee/dashboard")};return e.jsxs(X,{title:"شراء الدولار",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:G,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/buy.png",alt:"شراء الدولار",className:"w-12 h-12 object-contain",onError:a=>{a.target.style.display="none",a.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-cyan-600 hidden",children:"🛒"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"الرصيد الحالي"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-cyan-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-cyan-800 mb-2",children:"الرصيد المتبقي (دولار)"}),e.jsxs("p",{className:"text-3xl font-bold text-cyan-700",children:["$",Math.floor(b).toLocaleString()]})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-orange-800 mb-2",children:"الرصيد المتبقي (دينار)"}),e.jsxs("p",{className:"text-3xl font-bold text-orange-700",children:[Math.floor(b*p).toLocaleString()," د.ع"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي الحالي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(l).toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدولار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:["$",w>0?Math.floor(w).toLocaleString():"0"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدينار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[_>0?Math.floor(_).toLocaleString():"0"," د.ع"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"نقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[M>0?Math.floor(M).toLocaleString():"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-700",children:"منصرف:"}),e.jsxs("span",{className:"font-bold text-red-800",children:[d.charges>0?Math.floor(d.charges).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"دولار مشترى:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[d.dollars_bought>0?Math.floor(d.dollars_bought).toLocaleString():"0"," $"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:d.operations})]})})]}),e.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:t.documentNumber,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:k,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:v?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"المبلغ بالدولار",value:t.dollarAmount,max:b,onChange:a=>h("dollarAmount",a.target.value)}),t.dollarAmount&&c()>l&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["الرصيد النقدي غير كافي. المطلوب: ",Math.floor(c()).toLocaleString()," د.ع، المتاح: ",Math.floor(l).toLocaleString()," د.ع"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"سعر الصرف:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:`السعر الافتراضي: ${Math.floor(p)}`,value:Math.floor(t.exchangeRate),onChange:a=>h("exchangeRate",a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"العمولة (بالدينار العراقي):"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"العمولة",value:t.commission,onChange:a=>h("commission",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx("div",{className:"bg-cyan-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-cyan-700",children:"المبلغ بالدولار"}),e.jsxs("p",{className:"text-xl font-bold text-cyan-800",children:["$",Math.floor(parseFloat(t.dollarAmount||0)).toLocaleString()]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"المبلغ بالدينار"}),e.jsxs("p",{className:"text-xl font-bold text-orange-800",children:[Math.floor(j()).toLocaleString()," د.ع"]})]})}),e.jsx("div",{className:"bg-green-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-green-700",children:"المبلغ الكلي"}),e.jsxs("p",{className:"text-xl font-bold text-green-800",children:[c()>0?Math.floor(c()).toLocaleString():"0"," د.ع"]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:t.notes,onChange:a=>h("notes",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:P,disabled:x||!t.dollarAmount||c()>l,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),x?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:Y,disabled:x||!t.dollarAmount||c()>l,className:"bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),x?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),O&&T&&e.jsx(z,{receiptData:T,onClose:I,onPrint:q})]})}export{ae as default};
