import{r as n,j as e,b as H}from"./app-DVTFNskw.js";import{E as V}from"./EmployeeLayout-B6I1U2Cc.js";import{u as W,T as Z}from"./ThermalReceipt-7Jk97tAN.js";import{u as ee}from"./useCentralCashBalance-B90W-Hsj.js";import{u as te}from"./useCentralDollarBalance-D7W1chbr.js";/* empty css            */function me({user:N,currentDollarBalance:B=0,currentIQDBalance:F=0,currentCashBalance:S=0,currentCentralDollarBalance:k=0,openingDollarBalance:v=0,openingIQDBalance:w=0,openingCashBalance:_=0,exchangeRate:A=1500,transactions:ae=[],quickReport:m={charges:0,payments:0,operations:0,dollars_bought:0}}){const[O,M]=n.useState(B),[re,L]=n.useState(F),[se,R]=n.useState(S),[i,D]=n.useState({charges:m.charges,payments:m.payments,operations:m.operations,dollars_bought:m.dollars_bought}),{centralCashBalance:o,updateBalanceAfterTransaction:T}=ee(S),{centralDollarBalance:I,updateBalanceAfterTransaction:C}=te(k),[a,u]=n.useState({documentNumber:"",currentTime:new Date().toLocaleString("ar-EG"),dollarAmount:"",exchangeRate:A,notes:"",employeeName:N?.name||"الموظف الحالي"}),[g,x]=n.useState(!1),[E,h]=n.useState(""),[U,b]=n.useState(""),{showReceipt:Y,receiptData:$,createBuyReceipt:q,printReceipt:P,closeReceipt:G}=W();n.useEffect(()=>{const r=()=>{const l=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});b(l)};r();const s=setInterval(r,1e3);return()=>clearInterval(s)},[]),n.useEffect(()=>{(()=>{const s=new Date,t=s.getFullYear().toString()+(s.getMonth()+1).toString().padStart(2,"0")+s.getDate().toString().padStart(2,"0"),l=Math.floor(Math.random()*1e3).toString().padStart(3,"0");h(`BUY${t}${l}`)})()},[]),n.useEffect(()=>{u(r=>({...r,documentNumber:E}))},[E]);const p=(r,s)=>{u(t=>({...t,[r]:s}))},f=()=>{const r=parseFloat(a.dollarAmount)||0,s=parseFloat(a.exchangeRate)||0;return s>0?r*s:0},c=()=>f(),J=async()=>{if(!a.dollarAmount||parseFloat(a.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}const r=c();if(r>o){alert(`الرصيد النقدي المركزي غير كافي. المطلوب: ${Math.floor(r).toLocaleString()} د.ع، المتاح: ${Math.floor(o).toLocaleString()} د.ع`);return}x(!0);try{const s=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:a.dollarAmount,exchangeRate:a.exchangeRate,documentNumber:a.documentNumber,notes:a.notes})});if(s.ok){const t=await s.json();M(t.new_dollar_balance),L(t.new_iqd_balance),R(t.new_cash_balance),t.new_cash_balance!==void 0&&T(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&C(t.new_central_dollar_balance),t.updated_report&&D({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_bought:t.updated_report.dollars_bought}),u(j=>({...j,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const l=new Date,d=l.getFullYear().toString()+(l.getMonth()+1).toString().padStart(2,"0")+l.getDate().toString().padStart(2,"0"),y=Math.floor(Math.random()*1e3).toString().padStart(3,"0");h(`BUY${d}${y}`),b(l.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية الشراء بنجاح!")}else{const t=await s.json();alert(t.message||"حدث خطأ")}}catch(s){console.error("Error:",s),alert("حدث خطأ في الشبكة")}finally{x(!1)}},K=()=>{J()},X=async()=>{if(!a.dollarAmount||parseFloat(a.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}const r=c();if(r>o){alert(`الرصيد النقدي المركزي غير كافي. المطلوب: ${Math.floor(r).toLocaleString()} د.ع، المتاح: ${Math.floor(o).toLocaleString()} د.ع`);return}x(!0);try{const s=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:a.dollarAmount,exchangeRate:a.exchangeRate,documentNumber:a.documentNumber,notes:a.notes})});if(s.ok){const t=await s.json();if(M(t.new_dollar_balance),L(t.new_iqd_balance),R(t.new_cash_balance),t.new_cash_balance!==void 0&&T(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&C(t.new_central_dollar_balance),t.updated_report&&D({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_bought:t.updated_report.dollars_bought}),(await q({reference_number:a.documentNumber,dollar_amount:parseFloat(a.dollarAmount),exchange_rate:parseFloat(a.exchangeRate),iqd_amount:f(),total_amount:c(),notes:a.notes,customer_phone:null})).success){u(z=>({...z,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const d=new Date,y=d.getFullYear().toString()+(d.getMonth()+1).toString().padStart(2,"0")+d.getDate().toString().padStart(2,"0"),j=Math.floor(Math.random()*1e3).toString().padStart(3,"0");h(`BUY${y}${j}`),b(d.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية الشراء وإنشاء الفاتورة بنجاح!")}else alert("تم حفظ العملية لكن فشل في إنشاء الفاتورة")}else{const t=await s.json();alert(t.message||"حدث خطأ")}}catch(s){console.error("Error:",s),alert("حدث خطأ في الشبكة")}finally{x(!1)}},Q=()=>{H.visit("/employee/dashboard")};return e.jsxs(V,{title:"شراء الدولار",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/buy.png",alt:"شراء الدولار",className:"w-12 h-12 object-contain",onError:r=>{r.target.style.display="none",r.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-cyan-600 hidden",children:"🛒"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"شراء الدولار"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-cyan-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-cyan-800 mb-2",children:"الرصيد المركزي (دولار)"}),e.jsxs("p",{className:"text-3xl font-bold text-cyan-700",children:["$",Math.floor(I).toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(o).toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدولار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:["$",v>0?Math.floor(v).toLocaleString():"0"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدينار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[w>0?Math.floor(w).toLocaleString():"0"," د.ع"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"نقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[_>0?Math.floor(_).toLocaleString():"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-700",children:"منصرف:"}),e.jsxs("span",{className:"font-bold text-red-800",children:[i.charges>0?Math.floor(i.charges).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"دولار مشترى:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[i.dollars_bought>0?Math.floor(i.dollars_bought).toLocaleString():"0"," $"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:i.operations})]})})]}),e.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:a.documentNumber,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:U,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:N?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"المبلغ بالدولار",value:a.dollarAmount,max:O,onChange:r=>p("dollarAmount",r.target.value)}),a.dollarAmount&&c()>o&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["الرصيد النقدي المركزي غير كافي. المطلوب: ",Math.floor(c()).toLocaleString()," د.ع، المتاح: ",Math.floor(o).toLocaleString()," د.ع"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"سعر الصرف:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:`السعر الافتراضي: ${Math.floor(A)}`,value:Math.floor(a.exchangeRate),onChange:r=>p("exchangeRate",r.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{className:"bg-cyan-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-cyan-700",children:"المبلغ بالدولار"}),e.jsxs("p",{className:"text-xl font-bold text-cyan-800",children:["$",Math.floor(parseFloat(a.dollarAmount||0)).toLocaleString()]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"المبلغ بالدينار"}),e.jsxs("p",{className:"text-xl font-bold text-orange-800",children:[Math.floor(f()).toLocaleString()," د.ع"]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:a.notes,onChange:r=>p("notes",r.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:X,disabled:g||!a.dollarAmount||c()>o,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),g?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:K,disabled:g||!a.dollarAmount||c()>o,className:"bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),g?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),Y&&$&&e.jsx(Z,{receiptData:$,onClose:G,onPrint:P})]})}export{me as default};
