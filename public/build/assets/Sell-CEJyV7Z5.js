import{r as l,j as e,b as X}from"./app-QTctwzMn.js";import{E as q}from"./EmployeeLayout-61ULkqcU.js";import{u as z,T as H}from"./ThermalReceipt--4qaB1Xu.js";import{u as V}from"./useCentralCashBalance-DkDvqvJj.js";import{u as W}from"./useCentralDollarBalance-C3U3Jq12.js";/* empty css            */function ce({user:y,currentDollarBalance:T=0,currentBalance:E=0,currentCashBalance:C=0,currentCentralDollarBalance:F=0,openingDollarBalance:j=0,openingBalance:Z=0,openingCashBalance:N=0,exchangeRate:S=1500,transactions:ee=[],quickReport:c={charges:0,payments:0,operations:0,dollars_sold:0}}){const[v,w]=l.useState(T),[te,_]=l.useState(E),[o,A]=l.useState({charges:c.charges,payments:c.payments,operations:c.operations,dollars_sold:c.dollars_sold}),{centralCashBalance:M,updateBalanceAfterTransaction:L}=V(C),{centralDollarBalance:k,updateBalanceAfterTransaction:D}=W(F),[r,d]=l.useState({documentNumber:"",currentTime:new Date().toLocaleString("ar-EG"),dollarAmount:"",exchangeRate:S,notes:"",employeeName:y?.name||"الموظف الحالي"}),[i,m]=l.useState(!1),[g,u]=l.useState(""),[B,x]=l.useState(""),{showReceipt:O,receiptData:R,createSellReceipt:$,printReceipt:I,closeReceipt:P}=z();l.useEffect(()=>{const a=()=>{const n=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});x(n)};a();const t=setInterval(a,1e3);return()=>clearInterval(t)},[]),l.useEffect(()=>{(()=>{const t=new Date,s=t.getFullYear().toString()+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0"),n=Math.floor(Math.random()*1e3).toString().padStart(3,"0");u(`SELL${s}${n}`)})()},[]),l.useEffect(()=>{d(a=>({...a,documentNumber:g}))},[g]);const p=(a,t)=>{d(s=>({...s,[a]:t}))},h=()=>{const a=parseFloat(r.dollarAmount)||0,t=parseFloat(r.exchangeRate)||0;return a*t},G=()=>h(),U=async()=>{if(!r.dollarAmount||parseFloat(r.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}m(!0);try{const a=await fetch("/employee/sell",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:r.dollarAmount,exchangeRate:r.exchangeRate,documentNumber:r.documentNumber,notes:r.notes})});if(a.ok){const t=await a.json();w(t.new_dollar_balance),_(t.new_cash_balance),t.new_cash_balance!==void 0&&L(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&D(t.new_central_dollar_balance),t.updated_report&&A({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_sold:t.updated_report.dollars_sold}),d(f=>({...f,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const s=new Date,n=s.getFullYear().toString()+(s.getMonth()+1).toString().padStart(2,"0")+s.getDate().toString().padStart(2,"0"),b=Math.floor(Math.random()*1e3).toString().padStart(3,"0");u(`SELL${n}${b}`),x(s.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية البيع بنجاح!")}else{const t=await a.json();alert(t.message||"حدث خطأ")}}catch(a){console.error("Error:",a),alert("حدث خطأ في الشبكة")}finally{m(!1)}},Y=()=>{U()},J=async()=>{if(!r.dollarAmount||parseFloat(r.dollarAmount)<=0){alert("يرجى إدخال مبلغ صحيح بالدولار");return}m(!0);try{const a=await fetch("/employee/sell",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:r.dollarAmount,exchangeRate:r.exchangeRate,documentNumber:r.documentNumber,notes:r.notes})});if(a.ok){const t=await a.json();if(w(t.new_dollar_balance),_(t.new_cash_balance),t.new_cash_balance!==void 0&&L(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&D(t.new_central_dollar_balance),t.updated_report&&A({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_sold:t.updated_report.dollars_sold}),(await $({reference_number:r.documentNumber,dollar_amount:parseFloat(r.dollarAmount),exchange_rate:parseFloat(r.exchangeRate),iqd_amount:h(),total_amount:G(),notes:r.notes,customer_phone:null})).success){d(Q=>({...Q,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const n=new Date,b=n.getFullYear().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0"),f=Math.floor(Math.random()*1e3).toString().padStart(3,"0");u(`SELL${b}${f}`),x(n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),alert("تم إجراء عملية البيع وإنشاء الفاتورة بنجاح!")}else alert("تم حفظ العملية لكن فشل في إنشاء الفاتورة")}else{const t=await a.json();alert(t.message||"حدث خطأ")}}catch(a){console.error("Error:",a),alert("حدث خطأ في الشبكة")}finally{m(!1)}},K=()=>{X.visit("/employee/dashboard")};return e.jsxs(q,{title:"بيع الدولار",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:K,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/sell.png",alt:"بيع الدولار",className:"w-12 h-12 object-contain",onError:a=>{a.target.style.display="none",a.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-orange-600 hidden",children:"🏪"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"الرصيد الحالي"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-purple-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-2",children:"الرصيد المركزي للدولار"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-700",children:["$",Math.floor(k).toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(M).toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدولار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:["$",j>0?Math.floor(j).toLocaleString():"0"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدينار النقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[N>0?Math.floor(N).toLocaleString():"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-700",children:"مبيعات:"}),e.jsxs("span",{className:"font-bold text-green-800",children:[o.payments>0?Math.floor(o.payments).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"دولار مباع:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[o.dollars_sold>0?Math.floor(o.dollars_sold).toLocaleString():"0"," $"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:o.operations})]})})]}),e.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:r.documentNumber,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:g,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:B,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right bg-gray-50",value:y?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",placeholder:"المبلغ بالدولار",value:r.dollarAmount,onChange:a=>p("dollarAmount",a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"سعر الصرف:"}),e.jsx("input",{type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",value:r.exchangeRate,onChange:a=>p("exchangeRate",a.target.value),placeholder:"سعر الصرف"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 text-right",children:["السعر الافتراضي: ",S.toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{className:"bg-blue-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-700",children:"المبلغ بالدولار"}),e.jsxs("p",{className:"text-xl font-bold text-blue-800",children:["$",parseFloat(r.dollarAmount||0).toLocaleString()]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"المبلغ بالدينار"}),e.jsxs("p",{className:"text-xl font-bold text-orange-800",children:[h().toLocaleString()," د.ع"]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:r.notes,onChange:a=>p("notes",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:J,disabled:i||!r.dollarAmount||parseFloat(r.dollarAmount)>v,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),i?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:Y,disabled:i||!r.dollarAmount||parseFloat(r.dollarAmount)>v,className:"bg-orange-500 hover:bg-orange-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),i?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),O&&R&&e.jsx(H,{receiptData:R,onClose:P,onPrint:I})]})}export{ce as default};
