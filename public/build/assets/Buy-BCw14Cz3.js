import{r as l,j as e,d as ne}from"./app-Dj9b6vpa.js";import{E as re}from"./EmployeeLayout-BE5LYx1E.js";import{u as oe,T as le}from"./ThermalReceipt-3WR97ffO.js";import{u as ce}from"./useCentralCashBalance-Dhe9mmJI.js";import{u as ie}from"./useCentralDollarBalance-DO3vyDkh.js";import{u as de,N as me}from"./useNotification-C6JUMQqk.js";/* empty css            */function ve({user:v,currentDollarBalance:Y=0,currentIQDBalance:P=0,currentCashBalance:w=0,currentCentralDollarBalance:q=0,openingDollarBalance:_=0,openingIQDBalance:R=0,openingCashBalance:A=0,exchangeRate:M=1500,transactions:ue=[],quickReport:x={charges:0,payments:0,operations:0,dollars_bought:0}}){const[ge,C]=l.useState(Y),[xe,L]=l.useState(P),[he,F]=l.useState(w),[u,D]=l.useState({charges:x.charges,payments:x.payments,operations:x.operations,dollars_bought:x.dollars_bought}),{centralCashBalance:d,updateBalanceAfterTransaction:$}=ce(w),{centralDollarBalance:V,updateBalanceAfterTransaction:T}=ie(q),[s,g]=l.useState({documentNumber:"",currentTime:new Date().toLocaleString("ar-EG"),dollarAmount:"",exchangeRate:M,notes:"",employeeName:v?.name||"الموظف الحالي"}),[h,p]=l.useState(!1),[B,f]=l.useState(""),[G,y]=l.useState(""),{showReceipt:W,receiptData:E,createBuyReceipt:J,printReceipt:K,closeReceipt:X}=oe(),{notification:m,showSuccess:k,showError:c,showWarning:Q,closeNotification:z}=de();l.useEffect(()=>{const a=()=>{const r=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});y(r)};a();const t=setInterval(a,1e3);return()=>clearInterval(t)},[]),l.useEffect(()=>{(()=>{const t=new Date,n=t.getFullYear().toString()+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0"),r=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${n}${r}`)})()},[]),l.useEffect(()=>{g(a=>({...a,documentNumber:B}))},[B]),l.useEffect(()=>{parseFloat(s.dollarAmount||0),parseFloat(s.exchangeRate||0)},[s.dollarAmount,s.exchangeRate,d]);const O=a=>{const n=a.toString().replace(/[^0-9.]/g,"").split(".");return n.length>2?n[0]+"."+n.slice(1).join(""):(n[1]&&(n[1]=n[1].replace(/0+$/,""),n[1]===""&&n.pop()),n[0]&&(n[0]=n[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")),n.join("."))},I=a=>a.toString().replace(/,/g,""),H=(a,t)=>{const n=I(t);g(r=>({...r,[a]:n}))},U=(a,t)=>{const n=I(t);g(r=>({...r,[a]:n})),(a==="dollarAmount"||a==="exchangeRate")&&setTimeout(()=>{},0)},N=()=>{const a=parseFloat(s.dollarAmount)||0,t=parseFloat(s.exchangeRate)||0;return t>0?a*t:0},Z=()=>N(),j=()=>{const a=String(s.dollarAmount||"").trim(),t=String(s.exchangeRate||"").trim(),n=parseFloat(a),r=parseFloat(t);if(!a||isNaN(n)||n<=0||!t||isNaN(r)||r<=0)return null;const o=Math.round(n*r),i=Math.round(d);if(o>i){const S=o-i;return`الرصيد النقدي غير كافي. المطلوب: ${o.toLocaleString()} د.ع، المتاح: ${i.toLocaleString()} د.ع، النقص: ${S.toLocaleString()} د.ع`}return null},b=()=>{const a=String(s.dollarAmount||"").trim(),t=String(s.exchangeRate||"").trim(),n=parseFloat(a),r=parseFloat(t);if(!a||isNaN(n)||n<=0||!t||isNaN(r)||r<=0)return!1;const o=Math.round(n*r),i=Math.round(d);return o<=i},ee=async()=>{if(!b()){if(!s.dollarAmount||parseFloat(s.dollarAmount)<=0)c("خطأ في المدخلات","يرجى إدخال مبلغ صحيح بالدولار");else if(!s.exchangeRate||parseFloat(s.exchangeRate)<=0)c("خطأ في المدخلات","يرجى إدخال سعر صرف صحيح");else{const a=parseFloat(s.dollarAmount),t=parseFloat(s.exchangeRate),n=Math.round(a*t),r=Math.round(d),o=n-r;c("رصيد غير كافي",`الرصيد النقدي المركزي غير كافي. المطلوب: ${n.toLocaleString()} د.ع، المتاح: ${r.toLocaleString()} د.ع، النقص: ${o.toLocaleString()} د.ع`)}return}p(!0);try{const a=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:s.dollarAmount,exchangeRate:s.exchangeRate,documentNumber:s.documentNumber,notes:s.notes})});if(a.ok){const t=await a.json();C(t.new_dollar_balance),L(t.new_iqd_balance),F(t.new_cash_balance),t.new_cash_balance!==void 0&&$(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&T(t.new_central_dollar_balance),t.updated_report&&D({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_bought:t.updated_report.dollars_bought}),g(i=>({...i,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const n=new Date,r=n.getFullYear().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0"),o=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${r}${o}`),y(n.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),k("تم إنجاز العملية بنجاح!","تم إجراء عملية الشراء وتحديث الأرصدة بنجاح")}else{const t=await a.json();c("فشل في العملية",t.message||"حدث خطأ غير متوقع")}}catch(a){console.error("Error:",a),c("خطأ في الشبكة","تعذر الاتصال بالخادم، يرجى المحاولة مرة أخرى")}finally{p(!1)}},te=()=>{ee()},ae=async()=>{if(!b()){if(!s.dollarAmount||parseFloat(s.dollarAmount)<=0)c("خطأ في المدخلات","يرجى إدخال مبلغ صحيح بالدولار قبل المتابعة");else if(!s.exchangeRate||parseFloat(s.exchangeRate)<=0)c("خطأ في المدخلات","يرجى إدخال سعر صرف صحيح");else{const a=parseFloat(s.dollarAmount),t=parseFloat(s.exchangeRate),n=Math.round(a*t),r=Math.round(d),o=n-r;c("رصيد غير كافي",`الرصيد النقدي المركزي غير كافي. المطلوب: ${n.toLocaleString()} د.ع، المتاح: ${r.toLocaleString()} د.ع، النقص: ${o.toLocaleString()} د.ع`)}return}p(!0);try{const a=await fetch("/employee/buy",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({dollarAmount:s.dollarAmount,exchangeRate:s.exchangeRate,documentNumber:s.documentNumber,notes:s.notes})});if(a.ok){const t=await a.json();if(C(t.new_dollar_balance),L(t.new_iqd_balance),F(t.new_cash_balance),t.new_cash_balance!==void 0&&$(t.new_cash_balance),t.new_central_dollar_balance!==void 0&&T(t.new_central_dollar_balance),t.updated_report&&D({charges:t.updated_report.charges,payments:t.updated_report.payments,operations:t.updated_report.operations,dollars_bought:t.updated_report.dollars_bought}),(await J({reference_number:s.documentNumber,dollar_amount:parseFloat(s.dollarAmount),exchange_rate:parseFloat(s.exchangeRate),iqd_amount:N(),total_amount:Z(),notes:s.notes,customer_phone:null})).success){g(S=>({...S,dollarAmount:"",notes:"",currentTime:new Date().toLocaleString("ar-EG")}));const r=new Date,o=r.getFullYear().toString()+(r.getMonth()+1).toString().padStart(2,"0")+r.getDate().toString().padStart(2,"0"),i=Math.floor(Math.random()*1e3).toString().padStart(3,"0");f(`BUY${o}${i}`),y(r.toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),k("تم إنجاز العملية بنجاح!","تم إجراء عملية الشراء وإعداد الفاتورة للطباعة")}else Q("تحذير","تم حفظ العملية لكن فشل في إنشاء الفاتورة")}else{const t=await a.json();c("فشل في العملية",t.message||"حدث خطأ غير متوقع")}}catch(a){console.error("Error:",a),c("خطأ في الشبكة","تعذر الاتصال بالخادم، يرجى المحاولة مرة أخرى")}finally{p(!1)}},se=()=>{ne.visit("/employee/dashboard")};return e.jsxs(re,{title:"شراء الدولار",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:se,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/buy.png",alt:"شراء الدولار",className:"w-12 h-12 object-contain",onError:a=>{a.target.style.display="none",a.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-cyan-600 hidden",children:"🛒"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"شراء الدولار"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-cyan-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-cyan-800 mb-2",children:"الرصيد المركزي (دولار)"}),e.jsxs("p",{className:"text-3xl font-bold text-cyan-700",children:["$",Math.floor(V).toLocaleString()]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(d).toLocaleString()," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدولار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:["$",_>0?Math.floor(_).toLocaleString():"0"]})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"بالدينار:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[R>0?Math.floor(R).toLocaleString():"0"," د.ع"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"نقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[A>0?Math.floor(A).toLocaleString():"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-700",children:"منصرف:"}),e.jsxs("span",{className:"font-bold text-red-800",children:[u.charges>0?Math.floor(u.charges).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"دولار مشترى:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[u.dollars_bought>0?Math.floor(u.dollars_bought).toLocaleString():"0"," $"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:u.operations})]})})]}),e.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:s.documentNumber,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",value:G,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:v?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار:"}),e.jsx("input",{type:"text",className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right ${j()?"border-red-500 bg-red-50":"border-gray-300"}`,placeholder:"المبلغ بالدولار",value:s.dollarAmount?O(s.dollarAmount):"",onChange:a=>U("dollarAmount",a.target.value)}),j()&&e.jsx("p",{className:"text-xs text-red-600 mt-1 text-right font-medium",children:j()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"سعر الصرف:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:`السعر الافتراضي: ${Math.floor(M).toLocaleString()}`,value:s.exchangeRate?O(s.exchangeRate):"",onChange:a=>U("exchangeRate",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{className:"bg-cyan-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-cyan-700",children:"المبلغ بالدولار"}),e.jsxs("p",{className:"text-xl font-bold text-cyan-800",children:["$",Math.floor(parseFloat(s.dollarAmount||0)).toLocaleString()]})]})}),e.jsx("div",{className:"bg-orange-50 rounded-xl p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"text-sm font-semibold text-orange-700",children:"المبلغ بالدينار"}),e.jsxs("p",{className:"text-xl font-bold text-orange-800",children:[Math.floor(N()).toLocaleString()," د.ع"]})]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:s.notes,onChange:a=>H("notes",a.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:ae,disabled:h||!b(),className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),h?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:te,disabled:h||!b(),className:"bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),h?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),W&&E&&e.jsx(le,{receiptData:E,onClose:X,onPrint:K}),e.jsx(me,{isOpen:m.isOpen,type:m.type,title:m.title,message:m.message,autoClose:m.autoClose,autoCloseDelay:m.autoCloseDelay,onClose:z})]})}export{ve as default};
