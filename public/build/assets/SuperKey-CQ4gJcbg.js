import{r as c,j as e,b as ee}from"./app-BJ0Wl0JO.js";import{E as te}from"./EmployeeLayout-Bv6LMEmx.js";import{u as se,T as re}from"./ThermalReceipt-DjLrE8Vp.js";import{u as ae}from"./useCentralCashBalance-vu79bHBW.js";import{u as le,N as ne}from"./useNotification-BuTs7C_W.js";/* empty css            */function ge({user:b,currentBalance:L=0,currentCashBalance:R=0,transactions:oe=[],openingBalance:f=0,openingCashBalance:j=0,quickReport:x={charges:0,payments:0,operations:0}}){const[y,T]=c.useState(L),[o,N]=c.useState("charge"),[$,h]=c.useState(!1),[a,E]=c.useState({charges:x.charges,payments:x.payments,operations:x.operations}),{centralCashBalance:F,updateBalanceAfterTransaction:O}=ae(R),{showReceipt:A,receiptData:I,isCreatingReceipt:w,printReceipt:P,closeReceipt:B,createReceiptAndSave:H}=se(),{notification:d,showSuccess:K,showError:v,showWarning:S,closeNotification:Y}=le(),[n,g]=c.useState({amount:"",commission:"0",notes:""}),[u,C]=c.useState(!1),[p,D]=c.useState(""),[V,W]=c.useState("");c.useEffect(()=>{const t=()=>{const i=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});W(i)};t();const s=setInterval(t,1e3);return()=>clearInterval(s)},[]),c.useEffect(()=>{(()=>{const s=new Date,r=s.getFullYear().toString()+(s.getMonth()+1).toString().padStart(2,"0")+s.getDate().toString().padStart(2,"0"),i=Math.floor(Math.random()*1e3).toString().padStart(3,"0");D(`SUP${r}${i}`)})()},[]);const M=t=>{if(!t)return"";const s=t.toString().replace(/,/g,"");if(isNaN(s)||s==="")return t;const m=parseFloat(s).toString().split(".");return m[0]=m[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),m.join(".")},X=t=>t.toString().replace(/,/g,""),k=(t,s)=>{const r=X(s);(r===""||/^\d*\.?\d*$/.test(r))&&g(i=>({...i,[t]:r}))},z=(t,s)=>{g(r=>({...r,[t]:s}))},_=()=>{const t=parseFloat(n.amount)||0,s=parseFloat(n.commission)||0;return s>0?t+s:t},[l,G]=c.useState(null),J=async()=>{try{const t=await fetch("/employee/super-key/detailed-report",{method:"GET",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(t.ok){const s=await t.json();return G(s.report),s.report}}catch(t){console.error("Error fetching detailed report:",t)}return null},q=async()=>{await J()&&h(!0)},U=async t=>{if(!n.amount||parseFloat(n.amount)<=0){S("تحذير","يرجى إدخال مبلغ صحيح");return}C(!0);try{const s=await fetch(`/employee/super-key/${t}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({...n,reference_number:p})}),r=await s.json();if(s.ok&&r.success){T(r.new_balance),r.new_cash_balance!==void 0&&O(r.new_cash_balance),r.updated_report&&E({charges:r.updated_report.charges,payments:r.updated_report.payments,operations:r.updated_report.operations}),g({amount:"",commission:"0",notes:""});const i=new Date,m=i.getFullYear().toString()+(i.getMonth()+1).toString().padStart(2,"0")+i.getDate().toString().padStart(2,"0"),Z=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return D(`SUP${m}${Z}`),K("نجاح العملية",r.message),{success:!0,result:r}}else return v("خطأ",r.message||"حدث خطأ أثناء العملية"),{success:!1,error:r.message}}catch(s){return console.error("Error:",s),v("خطأ في الاتصال","حدث خطأ في الاتصال بالخادم"),{success:!1,error:s}}finally{C(!1)}},Q=async()=>{if(!n.amount||parseFloat(n.amount)<=0){S("تحذير","يرجى إدخال مبلغ صحيح");return}const t={transaction_type:o,reference_number:p,amount:n.amount,commission:n.commission,notes:n.notes,customer_phone:null};(await H(()=>U(o),t,"super_key")).success};return e.jsxs(te,{title:"سوبر كي",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",style:{maxHeight:"calc(100vh - 200px)",overflowY:"auto"},children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>ee.visit("/employee/dashboard"),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"w-20 h-20 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3",children:[e.jsx("img",{src:"/images/services/super-key.png",alt:"سوبر كي",className:"w-12 h-12 object-contain",onError:t=>{t.target.style.display="none",t.target.nextSibling.style.display="block"}}),e.jsx("span",{className:"text-2xl text-yellow-600 hidden",children:"🏛️"})]}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"سوبر كي"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-yellow-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"الرصيد المتبقي لسوبر كي"}),e.jsxs("p",{className:"text-3xl font-bold text-yellow-700",children:[Math.floor(y).toLocaleString("en-US")," د.ع"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(F).toLocaleString("en-US")," د.ع"]})]})]}),e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-800",children:"الرصيد الافتتاحي"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"سوبر كي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[f>0?Math.floor(f).toLocaleString("en-US"):"0"," د.ع"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"نقدي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[j>0?Math.floor(j).toLocaleString("en-US"):"0"," د.ع"]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير شامل - جميع العمليات"}),e.jsx("div",{className:"bg-red-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-700",children:"شحن:"}),e.jsxs("span",{className:"font-bold text-red-800",children:[a.charges>0?Math.floor(a.charges).toLocaleString("en-US"):"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-700",children:"دفع:"}),e.jsxs("span",{className:"font-bold text-green-800",children:[a.payments>0?Math.floor(a.payments).toLocaleString("en-US"):"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:a.operations})]})})]}),e.jsx("button",{onClick:q,className:"w-full bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>N("charge"),className:`px-6 py-3 rounded-lg font-semibold flex-1 transition-all duration-300 transform ${o==="charge"?"bg-red-500 text-white shadow-lg scale-105":"bg-transparent text-gray-700 hover:bg-gray-200"}`,children:"💰 شحن"}),e.jsx("button",{onClick:()=>N("payment"),className:`px-6 py-3 rounded-lg font-semibold flex-1 transition-all duration-300 transform ${o==="payment"?"bg-green-500 text-white shadow-lg scale-105":"bg-transparent text-gray-700 hover:bg-gray-200"}`,children:"💸 دفع"})]}),e.jsxs("div",{className:`mb-6 p-4 rounded-lg border-l-4 ${o==="charge"?"bg-red-50 border-red-500":"bg-green-50 border-green-500"}`,children:[e.jsx("h3",{className:`font-semibold ${o==="charge"?"text-red-800":"text-green-800"}`,children:o==="charge"?"🔴 وضع الشحن نشط":"🟢 وضع الدفع نشط"}),e.jsx("p",{className:`text-sm ${o==="charge"?"text-red-600":"text-green-600"}`,children:o==="charge"?"أدخل بيانات عملية الشحن":"أدخل بيانات عملية الدفع"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم المرجع:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right",value:p,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right",value:V,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"مدخل البيانات:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right bg-gray-50",value:b?.name||"غير محدد",readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right",placeholder:"المبلغ",value:n.amount?M(n.amount):"",onChange:t=>k("amount",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"العمولة:"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right",placeholder:"العمولة",value:n.commission?M(n.commission):"",onChange:t=>k("commission",t.target.value)})]})]}),e.jsx("div",{className:`rounded-xl p-4 mb-6 ${o==="charge"?"bg-red-50 border border-red-200":"bg-green-50 border border-green-200"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-lg font-semibold ${o==="charge"?"text-red-800":"text-green-800"}`,children:o==="charge"?"إجمالي الشحن:":"إجمالي الدفع:"}),e.jsxs("span",{className:`text-2xl font-bold ${o==="charge"?"text-red-700":"text-green-700"}`,children:[_()>0?Math.floor(_()).toLocaleString("en-US"):"0"," د.ع"]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:n.notes,onChange:t=>z("notes",t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:Q,disabled:u||w,className:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"📄"}),w?"جاري إنشاء الفاتورة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:()=>U(o),disabled:u,className:"bg-yellow-500 hover:bg-yellow-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),u?"جاري المعالجة...":"حفظ"]})]})]})})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[90vh] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-yellow-500 to-yellow-600 px-6 py-4 rounded-t-2xl flex-shrink-0",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center",children:[e.jsx("span",{className:"text-2xl mr-3",children:"📊"}),"التقرير المفصل - سوبر كي"]}),e.jsx("button",{onClick:()=>h(!1),className:"text-white hover:text-gray-200 text-3xl font-bold transition-colors duration-200",children:"×"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto overflow-x-hidden bg-gray-50 p-6",style:{minHeight:0,maxHeight:"calc(90vh - 80px)"},children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 mb-6 shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[e.jsx("span",{className:"text-xl mr-2",children:"👤"}),"معلومات الموظف"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-bold",children:"👨‍💼"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"اسم الموظف:"}),e.jsx("p",{className:"font-semibold text-gray-800",children:b?.name||"غير محدد"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-green-600 font-bold",children:"📅"})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-600",children:"تاريخ التقرير:"}),e.jsx("p",{className:"font-semibold text-gray-800",children:new Date().toLocaleDateString("en-US")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 border border-blue-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"🏦"})}),e.jsx("h4",{className:"text-sm font-semibold text-blue-700 mb-2",children:"الرصيد الافتتاحي"}),e.jsx("p",{className:"text-2xl font-bold text-blue-800",children:l?Math.floor(l.opening_balance).toLocaleString("en-US"):"0"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"د.ع"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-yellow-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"💰"})}),e.jsx("h4",{className:"text-sm font-semibold text-yellow-700 mb-2",children:"رصيد سوبر كي"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-800",children:l?Math.floor(l.current_balance).toLocaleString("en-US"):Math.floor(y).toLocaleString("en-US")}),e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"د.ع"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 border border-purple-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl",children:"📈"})}),e.jsx("h4",{className:"text-sm font-semibold text-purple-700 mb-2",children:"إجمالي العمليات"}),e.jsx("p",{className:"text-2xl font-bold text-purple-800",children:l?l.total_operations:a.operations}),e.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"عملية"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-red-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-semibold text-red-800 mb-4 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-red-600",children:"💸"})}),"عمليات الشحن"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-red-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-600",children:"إجمالي المبلغ:"}),e.jsxs("span",{className:"font-bold text-red-800 text-lg",children:[l?Math.floor(l.total_charges).toLocaleString("en-US"):Math.floor(a.charges).toLocaleString("en-US")," د.ع"]})]})}),e.jsx("div",{className:"bg-red-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-red-600",children:"عدد العمليات:"}),e.jsxs("span",{className:"font-bold text-red-800 text-lg",children:[l?l.charge_count:Math.floor(a.operations*(a.charges/(a.charges+a.payments||1)))," عملية"]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-green-200 shadow-sm",children:[e.jsxs("h4",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-green-600",children:"💰"})}),"عمليات الدفع"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-600",children:"إجمالي المبلغ:"}),e.jsxs("span",{className:"font-bold text-green-800 text-lg",children:[l?Math.floor(l.total_payments).toLocaleString("en-US"):Math.floor(a.payments).toLocaleString("en-US")," د.ع"]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-green-600",children:"عدد العمليات:"}),e.jsxs("span",{className:"font-bold text-green-800 text-lg",children:[l?l.payment_count:Math.floor(a.operations*(a.payments/(a.charges+a.payments||1)))," عملية"]})]})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-yellow-200 shadow-sm mb-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-yellow-800 mb-4 flex items-center",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-yellow-600",children:"💳"})}),"إجمالي العمولة"]}),e.jsx("div",{className:"bg-yellow-50 rounded-lg p-6",children:e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-3xl font-bold text-yellow-800",children:[l?Math.floor(l.total_commission).toLocaleString("en-US"):Math.floor((a.charges+a.payments)*.01).toLocaleString("en-US")," د.ع"]})})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:()=>h(!1),className:"bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-3 px-8 rounded-xl transition-all duration-200 flex items-center shadow-lg",children:[e.jsx("span",{className:"mr-2",children:"✖️"}),"إغلاق التقرير"]})})]})]})})]}),e.jsx(re,{show:A,receiptData:I,onClose:B,onPrint:P}),e.jsx(ne,{isOpen:d.isOpen,type:d.type,title:d.title,message:d.message,autoClose:d.autoClose,autoCloseDelay:d.autoCloseDelay,onClose:Y})]})}export{ge as default};
