import{r as n,j as e,b as U}from"./app-hH37bNpW.js";import{E as $}from"./EmployeeLayout-wvMZ0Je_.js";import{u as K}from"./useCentralCashBalance-CDxRVUow.js";import{g as _}from"./generateUniqueReference-CmjSDxgI.js";import{u as W,N as X}from"./useNotification-CHBgeroB.js";/* empty css            */function Z({user:S,transactions:z=[],quickReport:m={today_total:0,today_operations:0,total_amount:0,total_operations:0},currentCashBalance:A=0,openingCashBalance:h=0,centralExchangeRate:u=1320}){const{centralCashBalance:C,updateBalanceAfterTransaction:q}=K(A),{notification:i,showSuccess:k,showError:b,showWarning:y,closeNotification:D}=W(),[s,c]=n.useState({receiptNumber:"",tripNumber:"",fullName:"",usdAmount:"",iqdAmount:"",employeeName:S?.name||"الموظف الحالي",notes:""}),[x,N]=n.useState(!1),[T,L]=n.useState(""),[d,F]=n.useState({today_total:m.today_total,today_operations:m.today_operations,total_amount:m.total_amount,total_operations:m.total_operations}),[R,f]=n.useState(!1),[o,E]=n.useState(null);n.useEffect(()=>{const t=()=>{const l=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});L(l)};t();const a=setInterval(t,1e3);return()=>clearInterval(a)},[]),n.useEffect(()=>{(()=>{const a=_("TRV");c(r=>({...r,receiptNumber:a}))})()},[]);const j=t=>{if(!t)return"";const a=t.toString().replace(/,/g,"");if(isNaN(a)||a==="")return t;const g=parseFloat(a).toString().split(".");return g[0]=g[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),g.join(".")},O=t=>t.toString().replace(/,/g,""),v=(t,a)=>{const r=O(a);(r===""||/^\d*\.?\d*$/.test(r))&&c(l=>({...l,[t]:r}))},p=(t,a)=>{c(r=>({...r,[t]:a}))},I=()=>{const t=parseFloat(s.usdAmount)||0,a=parseFloat(s.iqdAmount)||0;return t*u+a},M=async()=>{try{const t=await fetch("/employee/travelers/detailed-report",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(t.ok){const a=await t.json();return E(a),a}else return console.error("فشل في جلب التقرير المفصل"),null}catch(t){return console.error("خطأ في جلب التقرير:",t),null}},B=async()=>{f(!0),o||await M()},w=async()=>{if(!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount){y("تحذير","يرجى ملء جميع الحقول المطلوبة");return}if(parseFloat(s.usdAmount)<=0||parseFloat(s.iqdAmount)<0){y("تحذير","يرجى إدخال مبالغ صحيحة");return}N(!0);try{const t=await fetch("/employee/travelers",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({receiptNumber:s.receiptNumber,tripNumber:s.tripNumber,fullName:s.fullName,usdAmount:s.usdAmount,iqdAmount:s.iqdAmount,notes:s.notes})});if(t.ok){const a=await t.json();a.new_cash_balance!==void 0&&q(a.new_cash_balance),a.updated_report&&F({today_total:a.updated_report.today_total,today_operations:a.updated_report.today_operations,total_amount:a.updated_report.total_amount,total_operations:a.updated_report.total_operations}),c(l=>({...l,tripNumber:"",fullName:"",usdAmount:"",iqdAmount:"",notes:""}));const r=_("TRV");c(l=>({...l,receiptNumber:r})),k("نجاح العملية","تم حفظ معاملة المسافر بنجاح!")}else{const a=await t.json();b("خطأ",a.message||"حدث خطأ")}}catch(t){console.error("Error:",t),b("خطأ في الشبكة","حدث خطأ في الشبكة")}finally{N(!1)}},V=()=>{U.visit("/employee/dashboard")};return e.jsxs($,{title:"خدمات المسافرين",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors duration-200 shadow-md",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl text-cyan-600",children:"✈️"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"خدمات المسافرين"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(C).toLocaleString()," د.ع"]})]}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الرصيد الافتتاحي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[h>0?Math.floor(h).toLocaleString():"0"," د.ع"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير المسافرين"}),e.jsx("div",{className:"bg-cyan-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-cyan-700",children:"إجمالي اليوم:"}),e.jsxs("span",{className:"font-bold text-cyan-800",children:[d.today_total>0?Math.floor(d.today_total).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"إجمالي الكل:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[d.total_amount>0?Math.floor(d.total_amount).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"عمليات اليوم:"}),e.jsx("span",{className:"font-bold text-gray-800",children:d.today_operations})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"إجمالي العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:d.total_operations})]})})]}),e.jsx("button",{onClick:B,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"خدمات المسافرين"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["سعر الصرف المركزي: ",u.toLocaleString()," د.ع"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:T,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم الإيصال:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:s.receiptNumber,readOnly:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"اسم منفذ العملية:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:s.employeeName,readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم الوجبة: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"أدخل رقم الوجبة",value:s.tripNumber,onChange:t=>p("tripNumber",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"الاسم الثلاثي: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"أدخل الاسم الثلاثي",value:s.fullName,onChange:t=>p("fullName",t.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"0.00",value:s.usdAmount?j(s.usdAmount):"",onChange:t=>v("usdAmount",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"العمولة بالدينار العراقي: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"0",value:s.iqdAmount?j(s.iqdAmount):"",onChange:t=>v("iqdAmount",t.target.value)})]})]}),e.jsxs("div",{className:"bg-cyan-50 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-cyan-800",children:"الإجمالي بالدينار العراقي:"}),e.jsxs("span",{className:"text-2xl font-bold text-cyan-700",children:[I().toLocaleString()," د.ع"]})]}),s.usdAmount&&e.jsxs("div",{className:"mt-2 text-sm text-cyan-600 text-right",children:["(",parseFloat(s.usdAmount||0).toFixed(2)," × ",u.toLocaleString(),") + ",parseFloat(s.iqdAmount||0).toLocaleString()]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:s.notes,onChange:t=>p("notes",t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:w,disabled:x||!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"🖨️"}),x?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:w,disabled:x||!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount,className:"bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),x?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"التقرير المفصل - خدمات المسافرين"}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]})}),e.jsx("div",{className:"p-6",children:o?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cyan-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-cyan-800",children:"إجمالي الدينار"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-700",children:[o.summary?.total_amount?.toLocaleString()||"0"," د.ع"]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"إجمالي الدولار"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["$",o.summary?.total_usd?.toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"العمولات"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[o.summary?.total_iqd_direct?.toLocaleString()||"0"," د.ع"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"عدد العمليات"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:o.summary?.total_transactions||0})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-right",children:"رقم الإيصال"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"رقم الوجبة"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"الاسم"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"USD"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"العمولة"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"الإجمالي"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"التاريخ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:o.transactions?.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:t.receipt_number}),e.jsx("td",{className:"px-4 py-2",children:t.trip_number}),e.jsx("td",{className:"px-4 py-2",children:t.full_name}),e.jsxs("td",{className:"px-4 py-2",children:["$",Number(t.usd_amount).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2",children:[Number(t.iqd_amount).toLocaleString()," د.ع"]}),e.jsxs("td",{className:"px-4 py-2 font-semibold",children:[Number(t.total_iqd).toLocaleString()," د.ع"]}),e.jsx("td",{className:"px-4 py-2",children:t.formatted_date})]},a))})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"جاري تحميل التقرير..."})]})})]})}),e.jsx(X,{isOpen:i.isOpen,type:i.type,title:i.title,message:i.message,autoClose:i.autoClose,autoCloseDelay:i.autoCloseDelay,onClose:D})]})}export{Z as default};
