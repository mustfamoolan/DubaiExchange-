import{r,j as e,b as L}from"./app-QTctwzMn.js";import{E as R}from"./EmployeeLayout-61ULkqcU.js";import{u as F}from"./useCentralCashBalance-DkDvqvJj.js";import{g as y}from"./generateUniqueReference-CmjSDxgI.js";/* empty css            */function K({user:N,transactions:E=[],quickReport:c={today_total:0,today_operations:0,total_amount:0,total_operations:0},currentCashBalance:f=0,openingCashBalance:p=0,centralExchangeRate:u=1320}){const{centralCashBalance:j,updateBalanceAfterTransaction:v}=F(f),[s,m]=r.useState({receiptNumber:"",tripNumber:"",fullName:"",usdAmount:"",iqdAmount:"",employeeName:N?.name||"الموظف الحالي",notes:""}),[x,g]=r.useState(!1),[w,_]=r.useState(""),[n,S]=r.useState({today_total:c.today_total,today_operations:c.today_operations,total_amount:c.total_amount,total_operations:c.total_operations}),[A,h]=r.useState(!1),[l,q]=r.useState(null);r.useEffect(()=>{const t=()=>{const i=new Date().toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"});_(i)};t();const a=setInterval(t,1e3);return()=>clearInterval(a)},[]),r.useEffect(()=>{(()=>{const a=y("TRV");m(o=>({...o,receiptNumber:a}))})()},[]);const d=(t,a)=>{m(o=>({...o,[t]:a}))},C=()=>{const t=parseFloat(s.usdAmount)||0,a=parseFloat(s.iqdAmount)||0;return t*u+a},k=async()=>{try{const t=await fetch("/employee/travelers/detailed-report",{method:"GET",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(t.ok){const a=await t.json();return q(a),a}else return console.error("فشل في جلب التقرير المفصل"),null}catch(t){return console.error("خطأ في جلب التقرير:",t),null}},T=async()=>{h(!0),l||await k()},b=async()=>{if(!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount){alert("يرجى ملء جميع الحقول المطلوبة");return}if(parseFloat(s.usdAmount)<=0||parseFloat(s.iqdAmount)<0){alert("يرجى إدخال مبالغ صحيحة");return}g(!0);try{const t=await fetch("/employee/travelers",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({receiptNumber:s.receiptNumber,tripNumber:s.tripNumber,fullName:s.fullName,usdAmount:s.usdAmount,iqdAmount:s.iqdAmount,notes:s.notes})});if(t.ok){const a=await t.json();a.new_cash_balance!==void 0&&v(a.new_cash_balance),a.updated_report&&S({today_total:a.updated_report.today_total,today_operations:a.updated_report.today_operations,total_amount:a.updated_report.total_amount,total_operations:a.updated_report.total_operations}),m(i=>({...i,tripNumber:"",fullName:"",usdAmount:"",iqdAmount:"",notes:""}));const o=y("TRV");m(i=>({...i,receiptNumber:o})),alert("تم حفظ معاملة المسافر بنجاح!")}else{const a=await t.json();alert(a.message||"حدث خطأ")}}catch(t){console.error("Error:",t),alert("حدث خطأ في الشبكة")}finally{g(!1)}},D=()=>{L.visit("/employee/dashboard")};return e.jsxs(R,{title:"خدمات المسافرين",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:D,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors duration-200",children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"العودة للصفحة الرئيسية"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-20 h-20 bg-cyan-100 rounded-full flex items-center justify-center mx-auto mb-3",children:e.jsx("span",{className:"text-2xl text-cyan-600",children:"✈️"})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"الرصيد النقدي المركزي"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"الرصيد النقدي المركزي"}),e.jsxs("p",{className:"text-3xl font-bold text-green-700",children:[Math.floor(j).toLocaleString()," د.ع"]})]}),e.jsx("div",{className:"bg-gray-50 rounded-xl p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"الرصيد الافتتاحي:"}),e.jsxs("span",{className:"font-bold text-gray-800",children:[p>0?Math.floor(p).toLocaleString():"0"," د.ع"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"تقرير المسافرين"}),e.jsx("div",{className:"bg-cyan-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-cyan-700",children:"إجمالي اليوم:"}),e.jsxs("span",{className:"font-bold text-cyan-800",children:[n.today_total>0?Math.floor(n.today_total).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"إجمالي الكل:"}),e.jsxs("span",{className:"font-bold text-blue-800",children:[n.total_amount>0?Math.floor(n.total_amount).toLocaleString():"0"," د.ع"]})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"عمليات اليوم:"}),e.jsx("span",{className:"font-bold text-gray-800",children:n.today_operations})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"إجمالي العمليات:"}),e.jsx("span",{className:"font-bold text-gray-800",children:n.total_operations})]})})]}),e.jsx("button",{onClick:T,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl transition-colors duration-200 mt-6",children:"تقرير مفصل"})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"خدمات المسافرين"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["سعر الصرف المركزي: ",u.toLocaleString()," د.ع"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"التاريخ والوقت:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:w,readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم الإيصال:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:s.receiptNumber,readOnly:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"اسم منفذ العملية:"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right bg-gray-50",value:s.employeeName,readOnly:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"رقم الوجبة: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"أدخل رقم الوجبة",value:s.tripNumber,onChange:t=>d("tripNumber",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"الاسم الثلاثي: *"}),e.jsx("input",{type:"text",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"أدخل الاسم الثلاثي",value:s.fullName,onChange:t=>d("fullName",t.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"المبلغ بالدولار: *"}),e.jsx("input",{type:"number",step:"0.01",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"0.00",value:s.usdAmount,onChange:t=>d("usdAmount",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"العمولة بالدينار العراقي: *"}),e.jsx("input",{type:"number",step:"1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",placeholder:"0",value:s.iqdAmount,onChange:t=>d("iqdAmount",t.target.value)})]})]}),e.jsxs("div",{className:"bg-cyan-50 rounded-xl p-6 mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-semibold text-cyan-800",children:"الإجمالي بالدينار العراقي:"}),e.jsxs("span",{className:"text-2xl font-bold text-cyan-700",children:[C().toLocaleString()," د.ع"]})]}),s.usdAmount&&e.jsxs("div",{className:"mt-2 text-sm text-cyan-600 text-right",children:["(",parseFloat(s.usdAmount||0).toFixed(2)," × ",u.toLocaleString(),") + ",parseFloat(s.iqdAmount||0).toLocaleString()]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-right",children:"ملاحظات:"}),e.jsx("textarea",{className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent text-right",rows:"3",placeholder:"ملاحظات إضافية...",value:s.notes,onChange:t=>d("notes",t.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:b,disabled:x||!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"🖨️"}),x?"جاري المعالجة...":"حفظ وطباعة"]}),e.jsxs("button",{onClick:b,disabled:x||!s.tripNumber||!s.fullName||!s.usdAmount||!s.iqdAmount,className:"bg-cyan-500 hover:bg-cyan-600 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-xl transition-colors duration-200 flex items-center justify-center",children:[e.jsx("span",{className:"ml-2",children:"💾"}),x?"جاري المعالجة...":"حفظ"]})]})]})})]})]}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"التقرير المفصل - خدمات المسافرين"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]})}),e.jsx("div",{className:"p-6",children:l?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-cyan-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-cyan-800",children:"إجمالي الدينار"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-700",children:[l.summary?.total_amount?.toLocaleString()||"0"," د.ع"]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"إجمالي الدولار"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700",children:["$",l.summary?.total_usd?.toFixed(2)||"0.00"]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-800",children:"العمولات"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700",children:[l.summary?.total_iqd_direct?.toLocaleString()||"0"," د.ع"]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"عدد العمليات"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:l.summary?.total_transactions||0})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-right",children:"رقم الإيصال"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"رقم الوجبة"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"الاسم"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"USD"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"العمولة"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"الإجمالي"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"التاريخ"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.transactions?.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:t.receipt_number}),e.jsx("td",{className:"px-4 py-2",children:t.trip_number}),e.jsx("td",{className:"px-4 py-2",children:t.full_name}),e.jsxs("td",{className:"px-4 py-2",children:["$",Number(t.usd_amount).toFixed(2)]}),e.jsxs("td",{className:"px-4 py-2",children:[Number(t.iqd_amount).toLocaleString()," د.ع"]}),e.jsxs("td",{className:"px-4 py-2 font-semibold",children:[Number(t.total_iqd).toLocaleString()," د.ع"]}),e.jsx("td",{className:"px-4 py-2",children:t.formatted_date})]},a))})]})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"جاري تحميل التقرير..."})]})})]})})]})}export{K as default};
